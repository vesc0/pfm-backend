{
    "info": {
        "_postman_id": "pfm-api-tests",
        "name": "PFM API Tests",
        "description": "API tests for Personal Finance Management backend.\nCovers all endpoints with status code and response schema validation.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:5138"
        }
    ],
    "item": [
        {
            "name": "Categories",
            "item": [
                {
                    "name": "Import Categories (CSV)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "// Import may return 200 (fresh) or 440 (already exists)",
                                    "pm.test('Status code is 200 or 440', function () {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 440]);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['message'],",
                                    "    properties: {",
                                    "        message: { type: 'string' }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches schema (has message string)', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "File",
                                    "type": "file",
                                    "src": "test-data/categories.csv"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{baseUrl}}/categories/import",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "categories",
                                "import"
                            ]
                        }
                    }
                },
                {
                    "name": "Import Categories – No File (400)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 400 when no file provided', function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": []
                        },
                        "url": {
                            "raw": "{{baseUrl}}/categories/import",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "categories",
                                "import"
                            ]
                        }
                    }
                },
                {
                    "name": "Get All Categories",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['items'],",
                                    "    properties: {",
                                    "        items: {",
                                    "            type: 'array',",
                                    "            items: {",
                                    "                type: 'object',",
                                    "                required: ['code', 'name'],",
                                    "                properties: {",
                                    "                    code:          { type: 'string' },",
                                    "                    name:          { type: 'string' },",
                                    "                    'parent-code': { type: ['string', 'null'] }",
                                    "                }",
                                    "            }",
                                    "        }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches category list schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Items array is not empty', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.items).to.be.an('array').that.is.not.empty;",
                                    "});",
                                    "",
                                    "pm.test('Each category has code and name strings', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    jsonData.items.forEach(function(cat) {",
                                    "        pm.expect(cat.code).to.be.a('string');",
                                    "        pm.expect(cat.name).to.be.a('string');",
                                    "    });",
                                    "});",
                                    "",
                                    "// Save a valid parent category code for later tests",
                                    "const jsonData = pm.response.json();",
                                    "if (jsonData.items && jsonData.items.length > 0) {",
                                    "    pm.environment.set('validCategoryCode', jsonData.items[0].code);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/categories",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "categories"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Categories By Parent ID",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has items array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('items');",
                                    "    pm.expect(jsonData.items).to.be.an('array');",
                                    "});",
                                    "",
                                    "pm.test('All items have the queried parent-code', function () {",
                                    "    const parentId = pm.environment.get('validCategoryCode') || 'B';",
                                    "    const jsonData = pm.response.json();",
                                    "    if (jsonData.items.length > 0) {",
                                    "        jsonData.items.forEach(function(cat) {",
                                    "            pm.expect(cat['parent-code']).to.eql(parentId);",
                                    "        });",
                                    "    }",
                                    "});",
                                    "",
                                    "// Save a sub-category code for categorize test",
                                    "const jsonData = pm.response.json();",
                                    "if (jsonData.items && jsonData.items.length > 0) {",
                                    "    pm.environment.set('validSubCategoryCode', jsonData.items[0].code);",
                                    "}"
                                ]
                            }
                        },
                        {
                            "listen": "prerequest",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "// Use the parent code saved from Get All Categories",
                                    "const parentCode = pm.environment.get('validCategoryCode') || 'B';",
                                    "pm.environment.set('parentCodeForQuery', parentCode);"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/categories?parent-id={{parentCodeForQuery}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "categories"
                            ],
                            "query": [
                                {
                                    "key": "parent-id",
                                    "value": "{{parentCodeForQuery}}"
                                }
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Transactions",
            "item": [
                {
                    "name": "Import Transactions (CSV)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "// Import may return 200 (first run), 400 (validation) or 440 (duplicates)",
                                    "pm.test('Status code is 200, 400, or 440', function () {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 400, 440]);",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});",
                                    "",
                                    "if (pm.response.code === 200) {",
                                    "    const schema = {",
                                    "        type: 'object',",
                                    "        required: ['message'],",
                                    "        properties: {",
                                    "            message: { type: 'string' }",
                                    "        }",
                                    "    };",
                                    "",
                                    "    pm.test('Success response has message field', function () {",
                                    "        const jsonData = pm.response.json();",
                                    "        pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "    });",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "File",
                                    "type": "file",
                                    "src": "test-data/transactions.csv"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{baseUrl}}/transactions/import",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "import"
                            ]
                        }
                    }
                },
                {
                    "name": "Import Transactions – No File (400)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 400 when no file provided', function () {",
                                    "    pm.response.to.have.status(400);",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": []
                        },
                        "url": {
                            "raw": "{{baseUrl}}/transactions/import",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "import"
                            ]
                        }
                    }
                },
                {
                    "name": "List Transactions (Default Pagination)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "const transactionSchema = {",
                                    "    type: 'object',",
                                    "    required: ['id', 'date', 'direction', 'amount', 'currency', 'kind'],",
                                    "    properties: {",
                                    "        id:                 { type: 'string' },",
                                    "        date:               { type: 'string' },",
                                    "        direction:          { type: 'string' },",
                                    "        amount:             { type: 'number' },",
                                    "        'beneficiary-name': { type: ['string', 'null'] },",
                                    "        description:        { type: ['string', 'null'] },",
                                    "        currency:           { type: 'string' },",
                                    "        mcc:                { type: ['number', 'null'] },",
                                    "        kind:               { type: 'string' },",
                                    "        catcode:            { type: ['string', 'null'] },",
                                    "        splits:             { type: 'array' }",
                                    "    }",
                                    "};",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['page-size', 'page', 'total-count', 'items'],",
                                    "    properties: {",
                                    "        'page-size':   { type: 'number' },",
                                    "        'page':        { type: 'number' },",
                                    "        'total-count': { type: 'number' },",
                                    "        'sort-by':     { type: ['string', 'null'] },",
                                    "        'sort-order':  { type: ['string', 'null'] },",
                                    "        items: {",
                                    "            type: 'array',",
                                    "            items: transactionSchema",
                                    "        }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches paginated transaction schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Items array contains transactions', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.items).to.be.an('array').that.is.not.empty;",
                                    "});",
                                    "",
                                    "pm.test('Default page is 1', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.page).to.eql(1);",
                                    "});",
                                    "",
                                    "pm.test('Default page-size is 10', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData['page-size']).to.eql(10);",
                                    "});",
                                    "",
                                    "// Save a transaction for categorize / split tests",
                                    "const jsonData = pm.response.json();",
                                    "if (jsonData.items && jsonData.items.length > 0) {",
                                    "    const txn = jsonData.items[0];",
                                    "    pm.environment.set('transactionId', txn.id);",
                                    "    pm.environment.set('transactionAmount', txn.amount);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/transactions",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions"
                            ]
                        }
                    }
                },
                {
                    "name": "List Transactions (With Filters)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has all pagination fields', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('page');",
                                    "    pm.expect(jsonData).to.have.property('page-size');",
                                    "    pm.expect(jsonData).to.have.property('total-count');",
                                    "    pm.expect(jsonData).to.have.property('sort-by');",
                                    "    pm.expect(jsonData).to.have.property('sort-order');",
                                    "    pm.expect(jsonData).to.have.property('items');",
                                    "});",
                                    "",
                                    "pm.test('Page size matches requested value of 5', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData['page-size']).to.eql(5);",
                                    "});",
                                    "",
                                    "pm.test('Items count is <= requested page size', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.items.length).to.be.at.most(5);",
                                    "});",
                                    "",
                                    "pm.test('Sort order is desc as requested', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData['sort-order']).to.eql('desc');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/transactions?page=1&page-size=5&sort-by=date&sort-order=desc&transaction-kind=pmt",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions"
                            ],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "1"
                                },
                                {
                                    "key": "page-size",
                                    "value": "5"
                                },
                                {
                                    "key": "sort-by",
                                    "value": "date"
                                },
                                {
                                    "key": "sort-order",
                                    "value": "desc"
                                },
                                {
                                    "key": "transaction-kind",
                                    "value": "pmt"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "List Transactions (Date Range)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['page-size', 'page', 'total-count', 'items'],",
                                    "    properties: {",
                                    "        'page-size':   { type: 'number' },",
                                    "        'page':        { type: 'number' },",
                                    "        'total-count': { type: 'number' },",
                                    "        items:         { type: 'array' }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches paginated schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Items is an array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.items).to.be.an('array');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/transactions?start-date=2021-01-01&end-date=2021-12-31",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions"
                            ],
                            "query": [
                                {
                                    "key": "start-date",
                                    "value": "2021-01-01"
                                },
                                {
                                    "key": "end-date",
                                    "value": "2021-12-31"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "Categorize Transaction",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "// Use the category code captured from Get Categories",
                                    "const catCode = pm.environment.get('validCategoryCode') || 'A';",
                                    "pm.environment.set('catCodeForTest', catCode);"
                                ]
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['message'],",
                                    "    properties: {",
                                    "        message: { type: 'string' }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Message confirms categorization', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.message.toLowerCase()).to.include('categorized');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"catcode\": \"{{catCodeForTest}}\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/transactions/{{transactionId}}/categorize",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "{{transactionId}}",
                                "categorize"
                            ]
                        }
                    }
                },
                {
                    "name": "Categorize Transaction – Not Found (440)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 440 for non-existent transaction', function () {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([400, 440]);",
                                    "});",
                                    "",
                                    "pm.test('Response has error message', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('message');",
                                    "    pm.expect(jsonData.message).to.be.a('string').that.is.not.empty;",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"catcode\": \"A\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/transactions/non-existent-id-99999/categorize",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "non-existent-id-99999",
                                "categorize"
                            ]
                        }
                    }
                },
                {
                    "name": "Split Transaction",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const catCode = pm.environment.get('validCategoryCode') || 'A';",
                                    "const amount  = parseFloat(pm.environment.get('transactionAmount')) || 100;",
                                    "const half    = Math.round((amount / 2) * 100) / 100;",
                                    "const rest    = Math.round((amount - half) * 100) / 100;",
                                    "",
                                    "const body = {",
                                    "    splits: [",
                                    "        { amount: half, catcode: catCode },",
                                    "        { amount: rest, catcode: catCode }",
                                    "    ]",
                                    "};",
                                    "",
                                    "pm.environment.set('splitBody', JSON.stringify(body));"
                                ]
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "// Split may return 200 (success) or 440 (business rule: wrong amounts)",
                                    "pm.test('Status code is 200 or 440', function () {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 440]);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['message'],",
                                    "    properties: {",
                                    "        message: { type: 'string' }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{{splitBody}}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/transactions/{{transactionId}}/split",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "{{transactionId}}",
                                "split"
                            ]
                        }
                    }
                },
                {
                    "name": "Auto-Categorize Transactions",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['categorized-count', 'total-transaction-count', 'categorized-percentage'],",
                                    "    properties: {",
                                    "        'categorized-count':        { type: 'number' },",
                                    "        'total-transaction-count':   { type: 'number' },",
                                    "        'categorized-percentage':    { type: 'number' }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches auto-categorize schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Counts are non-negative', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData['categorized-count']).to.be.at.least(0);",
                                    "    pm.expect(jsonData['total-transaction-count']).to.be.at.least(0);",
                                    "});",
                                    "",
                                    "pm.test('Percentage is between 0 and 100', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData['categorized-percentage']).to.be.within(0, 100);",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/transactions/auto-categorize",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "auto-categorize"
                            ]
                        }
                    }
                },
                {
                    "name": "Auto-Categorize Upload (YAML)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "// YAML upload may succeed (200) or fail validation (400)",
                                    "pm.test('Status code is 200 or 400', function () {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});",
                                    "",
                                    "if (pm.response.code === 200) {",
                                    "    const schema = {",
                                    "        type: 'object',",
                                    "        required: ['categorized-count', 'total-transaction-count', 'categorized-percentage'],",
                                    "        properties: {",
                                    "            'categorized-count':        { type: 'number' },",
                                    "            'total-transaction-count':   { type: 'number' },",
                                    "            'categorized-percentage':    { type: 'number' }",
                                    "        }",
                                    "    };",
                                    "",
                                    "    pm.test('Success response matches auto-categorize schema', function () {",
                                    "        const jsonData = pm.response.json();",
                                    "        pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "    });",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "File",
                                    "type": "file",
                                    "src": "test-data/auto-categorize-rules.yml"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{baseUrl}}/transactions/auto-categorize/upload",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "transactions",
                                "auto-categorize",
                                "upload"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Spending Analytics",
            "item": [
                {
                    "name": "Get Spending Analytics (No Filters)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "const schema = {",
                                    "    type: 'object',",
                                    "    required: ['groups'],",
                                    "    properties: {",
                                    "        groups: {",
                                    "            type: 'array',",
                                    "            items: {",
                                    "                type: 'object',",
                                    "                required: ['catcode', 'amount', 'count'],",
                                    "                properties: {",
                                    "                    catcode: { type: 'string' },",
                                    "                    amount:  { type: 'number' },",
                                    "                    count:   { type: 'number' }",
                                    "                }",
                                    "            }",
                                    "        }",
                                    "    }",
                                    "};",
                                    "",
                                    "pm.test('Response body matches spending analytics schema', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(tv4.validate(jsonData, schema)).to.be.true;",
                                    "});",
                                    "",
                                    "pm.test('Groups is an array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData.groups).to.be.an('array');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/spending-analytics",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "spending-analytics"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Spending Analytics (Date Range + Direction)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has groups array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('groups');",
                                    "    pm.expect(jsonData.groups).to.be.an('array');",
                                    "});",
                                    "",
                                    "pm.test('Each group has catcode, amount, count with correct types', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    jsonData.groups.forEach(function(g) {",
                                    "        pm.expect(g).to.have.property('catcode');",
                                    "        pm.expect(g.catcode).to.be.a('string');",
                                    "        pm.expect(g).to.have.property('amount');",
                                    "        pm.expect(g.amount).to.be.a('number');",
                                    "        pm.expect(g).to.have.property('count');",
                                    "        pm.expect(g.count).to.be.a('number');",
                                    "    });",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/spending-analytics?start-date=2021-01-01&end-date=2021-12-31&direction=d",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "spending-analytics"
                            ],
                            "query": [
                                {
                                    "key": "start-date",
                                    "value": "2021-01-01"
                                },
                                {
                                    "key": "end-date",
                                    "value": "2021-12-31"
                                },
                                {
                                    "key": "direction",
                                    "value": "d"
                                }
                            ]
                        }
                    }
                },
                {
                    "name": "Get Spending Analytics (By Category)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "pm.test('Status code is 200', function () {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response has groups array', function () {",
                                    "    const jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('groups');",
                                    "    pm.expect(jsonData.groups).to.be.an('array');",
                                    "});",
                                    "",
                                    "pm.test('Response content-type is JSON', function () {",
                                    "    pm.response.to.have.header('Content-Type');",
                                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/spending-analytics?catcode=B",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "spending-analytics"
                            ],
                            "query": [
                                {
                                    "key": "catcode",
                                    "value": "B"
                                }
                            ]
                        }
                    }
                }
            ]
        }
    ]
}